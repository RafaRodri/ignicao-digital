<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <title>Calculadora</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    </head>
    <body>
    <table border="1" width="500" height="500" id="calc" class="calc">
        <tr>
            <td colspan="5">
                <input class="calc-area" type="text" value="5-6+3*6">
            </td>
        </tr>
        <tr>
            <td class="num">7</td>
            <td class="num">8</td>
            <td class="num">9</td>
            <td class="op">/</td>
            <td class="clear">Clear</td>
        </tr>
        <tr>
            <td class="num">4</td>
            <td class="num">5</td>
            <td class="num">6</td>
            <td class="op">*</td>
            <td class="backspace"><i class="fas fa-arrow-left"></i></td>
        </tr>
        <tr>
            <td class="num">1</td>
            <td class="num">2</td>
            <td class="num">3</td>
            <td class="op">-</td>
            <td class="calculate" rowspan="2">=</td>
        </tr>
        <tr>
            <td class="num" colspan="2">0</td>
            <td class="decimal">,</td>
            <td class="op">+</td>
        </tr>
    </table>

    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script>
        const display = $(".calc-area");

        $(".clear").on("click", function () {
            display.val('0');
        });

        $(".calculate").on("click", function () {
            calculate();
        });

        $(".num").on("click", function () {
            value($(this).html());
        });

        $(".op").on("click", function () {
            operation($(this).html());
        });

        $(".decimal").on("click", function () {
            decimal();
        });


        function value(num) {
            if (display.val() == 0) {
                display.val('');
            } else {
                num = display.val() + '' + num;
            }

            display.val(num);
        }

        function operation(char) {
            if (display.val() != 0) {
                var displayValue = display.val();

                if (!getIfLastInt(display.val())) {
                    displayValue = removeChar(displayValue, 1);
                }

                char = displayValue + '' + char;
                display.val(char);
            }
        }

        function decimal() {
            var displayValue = display.val();

            if (getIfLastInt(displayValue) && !getIfLastIsComma(displayValue)) {
                display.val(displayValue + ',');
            }
        }

        function calculate() {
            var displayValue = display.val();

            if (!getIfLastInt(display.val())) {
                displayValue = removeChar(displayValue, 1);
            }

            display.val(eval(displayValue));
        }

        function removeChar(string, length) {
            return string.substring(0, string.length - length);
        }

        function getIfLastInt(string) {
            var last = string.substr(-1, 1);

            return (!isNaN(parseInt(last)));
        }

        function getIfLastIsComma(string) {
            var posComma = string.lastIndexOf(',');
            var comma = true;

            var elementIds = ['+', '-', '*', '/'];
            var elements = getElements(elementIds);

            Object.keys(elements).forEach(function (e) {
                if (posComma <= elements[e]) {
                    comma = false;
                    return false
                }
            });

            return comma;
        }

        function getElements(ids) {
            return ids.reduce(function (accumulator, id) {
                accumulator[id] = display.val().lastIndexOf(id);
                return accumulator;
            }, {});
        }
    </script>
    </body>
</html>
